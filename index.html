<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soul Calculator | Visual Personality Test</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Outfit:wght@300;400;500;700;800&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">

    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-body: #FAFAFA;
            --bg-card: #FFFFFF;
            --text-main: #1F2937;
            --text-muted: #9CA3AF;
            --grad-primary: linear-gradient(135deg, #6366f1, #8b5cf6);
            --grad-cosmic: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            --shadow-soft: 0 10px 40px -10px rgba(0,0,0,0.08);
            --shadow-hover: 0 20px 40px -10px rgba(0,0,0,0.15);
        }

        body { 
            font-family: 'Outfit', sans-serif;
            background: var(--bg-body); 
            color: var(--text-main); 
            overflow-x: hidden;
            padding-bottom: 80px;
        }

        .stylish-font { font-family: 'Cinzel Decorative', serif; }
        .urdu { font-family: 'Noto Nastaliq Urdu', serif; line-height: 2.2; }

        /* Custom UI Elements */
        .luxury-card {
            background: var(--bg-card);
            border-radius: 24px;
            box-shadow: var(--shadow-soft);
            border: 1px solid rgba(0,0,0,0.03);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .fashion-input {
            width: 100%; background: transparent; border: none;
            border-bottom: 2px solid #E5E7EB;
            padding: 1rem 0; color: var(--text-main); font-size: 1.2rem;
            outline: none; transition: all 0.3s;
        }
        .fashion-input:focus { border-bottom-color: #6366f1; }
        
        .input-group { position: relative; margin-bottom: 2rem; }
        .fashion-label {
            position: absolute; top: 1rem; left: 0; width: 100%;
            color: var(--text-muted); text-transform: uppercase;
            font-size: 0.8rem; letter-spacing: 0.1em; pointer-events: none;
            transition: all 0.3s; font-weight: 600;
        }
        .fashion-input:focus ~ .fashion-label,
        .fashion-input:not(:placeholder-shown) ~ .fashion-label {
            top: -1.2rem; color: #6366f1; font-size: 0.7rem;
        }

        .btn-fancy {
            background: var(--text-main);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            font-weight: 700;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .btn-fancy:active { transform: scale(0.98); }

        /* Dashboard Styles */
        .dashboard-header {
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--bg-card);
            position: sticky;
            top: 0;
            z-index: 40;
            box-shadow: 0 4px 20px rgba(0,0,0,0.03);
        }

        .carousel-container {
            display: flex;
            overflow-x: auto;
            scroll-snap-type: x mandatory;
            gap: 1rem;
            padding: 0 1.5rem 1.5rem;
            scrollbar-width: none;
        }
        .carousel-container::-webkit-scrollbar { display: none; }

        .slide-card {
            flex: 0 0 90%;
            scroll-snap-align: center;
            height: 200px;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            padding: 1.5rem;
            box-shadow: var(--shadow-soft);
            color: white;
        }

        .quick-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            padding: 0 1.5rem;
        }

        .app-icon {
            width: 72px; height: 72px;
            border-radius: 20px;
            background: var(--bg-card);
            display: flex; align-items: center; justify-content: center;
            font-size: 2rem;
            box-shadow: var(--shadow-soft);
            border: 1px solid #F3F4F6;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .app-icon-wrapper:hover .app-icon {
            transform: translateY(-5px);
            border-color: #6366f1;
            box-shadow: var(--shadow-hover);
        }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .processing-orb {
            width: 80px; height: 80px; border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #6366f1, transparent);
            filter: blur(5px); animation: orbSpin 1.5s linear infinite;
            margin: 0 auto 2rem;
        }
        @keyframes orbSpin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        #side-menu {
            transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            transform: translateX(-100%);
        }
        #side-menu.open { transform: translateX(0); }

        /* Custom Alert Modal */
        #custom-alert {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.5);
            z-index: 100;
            align-items: center;
            justify-content: center;
        }

        /* Chart container constraint */
        .chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
    </style>
</head>
<body class="flex flex-col items-center">

    <!-- Custom Alert -->
    <div id="custom-alert">
        <div class="bg-white p-8 rounded-3xl max-w-xs w-full text-center shadow-2xl">
            <div class="text-4xl mb-4">‚ö†Ô∏è</div>
            <p id="alert-message" class="text-gray-900 font-bold mb-6"></p>
            <button onclick="closeAlert()" class="btn-fancy px-8 py-3 rounded-xl w-full">Got it</button>
        </div>
    </div>

    <!-- Sticky Header -->
    <header class="dashboard-header w-full max-w-lg">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg">
                <span class="text-2xl">üîÆ</span>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-none text-gray-900">Soul Calc</h1>
                <p class="text-[10px] text-gray-400 font-bold tracking-widest uppercase">V2.0 Premium</p>
            </div>
        </div>
        <button onclick="toggleMenu()" class="w-10 h-10 rounded-full bg-gray-50 flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
        </button>
    </header>

    <!-- Side Menu -->
    <div id="side-menu" class="fixed top-0 left-0 h-full w-80 z-50 p-8 shadow-2xl overflow-y-auto bg-white border-r border-gray-100">
        <div class="flex justify-between items-center mb-10 pt-4">
            <h2 class="text-xl font-bold tracking-widest text-gray-900">SYSTEM</h2>
            <button onclick="toggleMenu()" class="text-gray-400 hover:text-gray-900 text-2xl">&times;</button>
        </div>
        <div class="space-y-6">
            <div>
                <h3 class="text-[10px] font-bold uppercase tracking-widest text-indigo-500 mb-2">Algorithm</h3>
                <p class="text-sm text-gray-500 leading-relaxed">Merging Elemental Traits, Zodiac Archetypes, and Ancient Abjad Numerology.</p>
            </div>
            <div>
                <h3 class="text-[10px] font-bold uppercase tracking-widest text-indigo-500 mb-2">Contributors</h3>
                <p class="text-sm font-bold text-gray-900">Muzammil Mahmood</p>
                <p class="text-xs text-gray-500">Lead Engineer</p>
            </div>
            <button onclick="resetApp()" class="w-full py-4 border-2 border-red-50 text-red-500 rounded-2xl text-xs font-bold uppercase tracking-widest mt-12 hover:bg-red-50 transition-colors">
                Reset Matrix
            </button>
        </div>
    </div>

    <!-- MAIN APP -->
    <div class="w-full max-w-lg pb-24">

        <!-- DASHBOARD -->
        <main id="home-view" class="fade-in">
            <p class="px-6 mt-8 text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-4">Featured Highlight</p>
            <div class="carousel-container">
                <div class="slide-card group cursor-pointer" onclick="openApp('intro-view')">
                    <div class="absolute inset-0 bg-gradient-to-br from-indigo-600 to-purple-700 z-0"></div>
                    <div class="relative z-10">
                        <span class="px-3 py-1 bg-white/20 backdrop-blur rounded-full text-[9px] font-bold uppercase tracking-widest w-fit mb-2 inline-block">New Feature</span>
                        <h3 class="text-2xl font-bold mb-1">Visual Personality Test</h3>
                        <p class="text-sm opacity-90">Discover your elemental nature through imagery.</p>
                    </div>
                </div>
            </div>

            <p class="px-6 mt-6 text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-4">Direct Access</p>
            <div class="quick-grid">
                <div class="app-icon-wrapper flex flex-col items-center gap-2 cursor-pointer" onclick="openApp('intro-view')">
                    <div class="app-icon">üîÆ</div>
                    <span class="text-[10px] font-bold text-gray-600">SoulCalc</span>
                </div>
                <div class="app-icon-wrapper flex flex-col items-center gap-2 opacity-40">
                    <div class="app-icon">‚ôâ</div>
                    <span class="text-[10px] font-bold text-gray-600">Zodiac</span>
                </div>
                <div class="app-icon-wrapper flex flex-col items-center gap-2 opacity-40">
                    <div class="app-icon">üÉè</div>
                    <span class="text-[10px] font-bold text-gray-600">Tarot</span>
                </div>
            </div>

            <p class="px-6 mt-12 text-[10px] font-bold uppercase tracking-widest text-gray-400 mb-4">Session History</p>
            <div class="px-6" id="history-container">
                <div class="luxury-card p-6 flex items-center gap-4 border-dashed border-2 border-gray-100 bg-gray-50/50">
                    <div class="w-10 h-10 rounded-full flex items-center justify-center text-gray-300 text-xl">
                        ‚è≥
                    </div>
                    <p class="text-sm font-bold text-gray-400">No active profile logs</p>
                </div>
            </div>
        </main>

        <!-- 1. REGISTRATION -->
        <main id="intro-view" class="hidden px-6 pt-6 fade-in">
            <button onclick="goHome()" class="mb-6 text-sm font-bold text-gray-400">‚Üê Exit</button>
            <div class="luxury-card p-8 text-center">
                <div class="w-16 h-16 bg-indigo-50 text-indigo-600 rounded-full flex items-center justify-center mx-auto mb-6 text-2xl">üîë</div>
                <h2 class="text-2xl font-bold mb-2">Visual Personality Test</h2>
                <p class="text-gray-400 text-sm mb-10">Enter your details to begin the visual assessment.</p>
                <div class="text-left">
                    <div class="input-group">
                        <input type="text" id="reg-name" class="fashion-input" placeholder=" ">
                        <label class="fashion-label">Agent Alias</label>
                    </div>
                </div>
                <button onclick="goToIntro()" class="btn-fancy w-full py-4 rounded-xl mt-4">Initialize Ritual</button>
            </div>
        </main>

        <!-- 2. VISUAL QUIZ -->
        <main id="quiz-view" class="hidden px-6 pt-6 fade-in">
            <div class="flex justify-between items-center mb-6">
                <button onclick="goHome()" class="text-xs font-bold text-gray-400 uppercase tracking-widest">Cancel</button>
                <div class="h-1 w-24 bg-gray-100 rounded-full overflow-hidden">
                    <div id="quiz-progress-bar" class="h-full bg-indigo-500 transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>
            <h2 id="quiz-title" class="text-2xl font-bold mb-2">Step 1</h2>
            <p id="quiz-question" class="text-gray-400 text-sm mb-8"></p>
            
            <div id="trait-grid" class="grid grid-cols-2 gap-4 mb-12"></div>
            
            <div id="quiz-footer" class="fixed bottom-0 left-0 w-full bg-white border-t p-6 flex justify-between items-center z-50">
                <span id="counter" class="text-2xl font-bold text-gray-900">0%</span>
                <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Analysis in Progress</span>
            </div>
        </main>

        <!-- 3. DATE -->
        <main id="date-view" class="hidden px-6 pt-6 fade-in">
            <div class="luxury-card p-8 text-center mt-12">
                <h2 class="text-2xl font-bold mb-2">Temporal Lock</h2>
                <p class="text-gray-400 text-sm mb-10">Select your cosmic entry coordinates.</p>
                <div class="text-left space-y-8 mb-10">
                    <div>
                        <label class="text-[10px] font-bold text-indigo-500 uppercase tracking-[0.2em] mb-3 block">Month of Arrival</label>
                        <select id="birth-month" class="fashion-input cursor-pointer">
                            <option value="1">January</option><option value="2">February</option><option value="3">March</option>
                            <option value="4">April</option><option value="5">May</option><option value="6">June</option>
                            <option value="7">July</option><option value="8">August</option><option value="9">September</option>
                            <option value="10">October</option><option value="11">November</option><option value="12">December</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <input type="number" id="birth-day" class="fashion-input" placeholder=" " min="1" max="31">
                        <label class="fashion-label">Day (01-31)</label>
                    </div>
                </div>
                <button onclick="goToNameView()" class="btn-fancy w-full py-4 rounded-xl">Seal Lock</button>
            </div>
        </main>

        <!-- 4. URDU NAME -->
        <main id="name-view" class="hidden px-6 pt-6 fade-in">
            <div class="luxury-card p-8 text-center mt-12">
                <h2 class="text-2xl font-bold mb-2">Spiritual Key</h2>
                <p class="text-gray-400 text-sm mb-12">Enter your name in Urdu script for Abjad calculation.</p>
                <div class="mb-12">
                    <input type="text" id="user-name-urdu" class="fashion-input text-center text-4xl urdu" placeholder="ŸÖÿ≤ŸÖŸÑ" dir="rtl" oninput="liveUpdateAbjad(this.value)">
                    <div id="live-calc-box" class="mt-6 opacity-0 transition-opacity duration-300">
                        <span class="px-4 py-1 bg-indigo-50 text-indigo-600 rounded-full text-[10px] font-bold uppercase tracking-widest">
                            Numerical Weight: <span id="live-score">0</span>
                        </span>
                    </div>
                </div>
                <button onclick="startProcessing()" class="btn-fancy w-full py-4 rounded-xl">Calculate Destiny</button>
            </div>
        </main>

        <!-- 5. PROCESSING -->
        <main id="processing-view" class="hidden px-6 flex flex-col items-center justify-center min-h-[60vh] text-center">
            <div class="processing-orb"></div>
            <h2 id="process-text" class="text-2xl font-bold text-gray-900 mb-2">Synchronizing...</h2>
            <p class="text-gray-400 text-sm">Accessing cosmic records</p>
        </main>

        <!-- 6. RESULTS -->
        <main id="result-view" class="hidden px-6 pt-12 pb-20 fade-in">
            <div class="text-center mb-10">
                <p class="text-indigo-500 text-[10px] font-bold uppercase tracking-[0.3em] mb-2">Ritual Complete</p>
                <h2 id="final-user-name" class="text-3xl font-bold text-gray-900"></h2>
            </div>

            <!-- Primary Element Card -->
            <div id="element-card" class="luxury-card p-8 mb-8 text-white relative" style="background: var(--grad-cosmic)">
                <div class="relative z-10">
                    <h1 id="display-name" class="text-5xl font-bold urdu text-center mb-6"></h1>
                    <div class="flex flex-col items-center gap-2 mb-10">
                        <div id="winner-icon" class="text-7xl mb-2"></div>
                        <h2 id="winner-name" class="text-4xl font-bold tracking-tight"></h2>
                        <p id="winner-urdu" class="urdu text-xl opacity-70"></p>
                    </div>
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-md">
                            <span class="text-[8px] font-bold uppercase tracking-widest text-cyan-400 block mb-2">Essence</span>
                            <p id="qualities-text" class="text-xs leading-relaxed opacity-90"></p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-2xl backdrop-blur-md">
                            <span class="text-[8px] font-bold uppercase tracking-widest text-pink-400 block mb-2">Shadow</span>
                            <p id="challenges-text" class="text-xs leading-relaxed opacity-90"></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Zodiac Insight -->
            <div class="luxury-card p-6 mb-8 flex items-center gap-6">
                <div id="zodiac-icon" class="text-5xl"></div>
                <div>
                    <h3 id="zodiac-name" class="text-xl font-bold text-gray-900"></h3>
                    <p id="zodiac-desc" class="text-sm text-gray-500 mb-2"></p>
                    <p id="zodiac-vocal" class="text-[10px] font-bold text-indigo-500 uppercase tracking-widest"></p>
                </div>
            </div>

            <!-- Radar Chart -->
            <div class="luxury-card p-8 mb-8">
                <h3 class="text-[10px] font-bold text-gray-400 uppercase tracking-widest text-center mb-6">Elemental Spectrum</h3>
                <div class="chart-container">
                    <canvas id="elementChart"></canvas>
                </div>
            </div>

            <!-- Abjad Matches -->
            <div class="luxury-card p-8 border-emerald-100 bg-emerald-50/30">
                <div class="flex justify-between items-center mb-8">
                    <div>
                        <span class="text-emerald-600 text-[10px] font-bold uppercase tracking-widest block">Abjad Score</span>
                        <h3 class="text-3xl font-bold text-emerald-900" id="abjad-sum">0</h3>
                    </div>
                    <div class="text-4xl">üî¢</div>
                </div>
                <div id="abjad-matches" class="space-y-4"></div>
            </div>

            <button onclick="resetApp()" class="btn-fancy w-full py-5 rounded-2xl mt-12 mb-8">Restart Sequence</button>
        </main>

    </div>

    <script>
        // --- CONSTANTS & DATA ---
        const ABJAD_MAP = {'ÿß': 1, 'ÿ¢': 1, 'ÿ£': 1, 'ÿ•': 1, 'ÿ°': 1, 'ÿ®': 2, 'Ÿæ': 2, 'ÿ¨': 3, '⁄Ü': 3, 'ÿØ': 4, '⁄à': 4, 'Ÿá': 5, '€Å': 5, 'ÿ©': 5, '⁄æ': 5, 'Ÿà': 6, 'ÿ§': 6, 'ÿ≤': 7, '⁄ò': 7, 'ÿ≠': 8, 'ÿ∑': 9, '€å': 10, 'Ÿä': 10, 'Ÿâ': 10, 'ÿ¶': 10, '€í': 10, '⁄©': 20, 'ŸÉ': 20, '⁄Ø': 20, 'ŸÑ': 30, 'ŸÖ': 40, 'ŸÜ': 50, '⁄∫': 50, 'ÿ≥': 60, 'ÿπ': 70, 'ŸÅ': 80, 'ÿµ': 90, 'ŸÇ': 100, 'ÿ±': 200, '⁄ë': 200, 'ÿ¥': 300, 'ÿ™': 400, 'Ÿπ': 400, 'ÿ´': 500, 'ÿÆ': 600, 'ÿ∞': 700, 'ÿ∂': 800, 'ÿ∏': 900, 'ÿ∫': 1000};

        const ELEMENTS = {
            Fire: { urdu: "ÿ¢ÿ™ÿ¥€å (Agni)", icon: 'üî•', q: "Driven, Brave, Competitive, Visionary", c: "Impulsive, stubborn, burnout risk" },
            Air: { urdu: "€ÅŸàÿßÿ¶€å (Hawa)", icon: 'üå™Ô∏è', q: "Witty, Charming, Intellectual, Adaptable", c: "Inconsistent, lack of focus, detached" },
            Water: { urdu: "ÿ¢ÿ®€å (Pani)", icon: 'üíß', q: "Intuitive, Romantic, Dreamer, Empathetic", c: "Over-sensitive, avoids conflict, moody" },
            Earth: { urdu: "ÿÆÿß⁄©€å (Mitti)", icon: 'üåø', q: "Reliable, Practical, Grounded, Patient", c: "Rigid, overthinking, slow to change" }
        };

        const ZODIAC_DATA = [
            { name: "Aquarius", icon: "‚ôí", start: [1, 20], end: [2, 18], p: "Creative, independent", s: "Experimental Vocals" },
            { name: "Pisces", icon: "‚ôì", start: [2, 19], end: [3, 20], p: "Dreamy, emotional", s: "Soulful Melodies" },
            { name: "Aries", icon: "‚ôà", start: [3, 21], end: [4, 19], p: "Bold, leader", s: "Powerful High-Energy" },
            { name: "Taurus", icon: "‚ôâ", start: [4, 20], end: [5, 20], p: "Calm, loyal", s: "Romantic Smooth Voice" },
            { name: "Gemini", icon: "‚ôä", start: [5, 21], end: [6, 20], p: "Intellectual, adaptable", s: "Playful Pop Vocals" },
            { name: "Cancer", icon: "‚ôã", start: [6, 21], end: [7, 22], p: "Caring, sensitive", s: "Emotional Soft Vocals" },
            { name: "Leo", icon: "‚ôå", start: [7, 23], end: [8, 22], p: "Confident, dramatic", s: "Powerful Star Presence" },
            { name: "Virgo", icon: "‚ôç", start: [8, 23], end: [9, 22], p: "Practical, calm", s: "Meaningful Clean Vocals" },
            { name: "Libra", icon: "‚ôé", start: [9, 23], end: [10, 22], p: "Charming, balanced", s: "Harmonious Duet Tone" },
            { name: "Scorpio", icon: "‚ôè", start: [10, 23], end: [11, 21], p: "Mysterious, passionate", s: "Deep Dark-Tone Vocals" },
            { name: "Sagittarius", icon: "‚ôê", start: [11, 22], end: [12, 21], p: "Adventurous, free-spirited", s: "Upbeat Party Vibe" },
            { name: "Capricorn", icon: "‚ôë", start: [12, 22], end: [1, 19], p: "Disciplined, ambitious", s: "Classic Strong Vocals" }
        ];

        const ASMA_UL_HUSNA = [
            { a: "ÿßŸÑŸÑŸá", t: "Allah", s: 66, m: "ÿÆÿØÿß" },
            { a: "ÿßŸÑÿ±ÿ≠ŸÖŸÜ", t: "Ar-Rahman", s: 298, m: "ÿ®€Åÿ™ ŸÖ€Åÿ±ÿ®ÿßŸÜ" },
            { a: "ÿßŸÑÿ±ÿ≠ŸäŸÖ", t: "Ar-Rahim", s: 258, m: "ŸÜ€Åÿß€åÿ™ ÿ±ÿ≠ŸÖ ŸàÿßŸÑÿß" },
            { a: "ÿßŸÑŸÖŸÑŸÉ", t: "Al-Malik", s: 90, m: "ÿ®ÿßÿØÿ¥ÿß€Å" },
            { a: "ÿßŸÑÿ≥ŸÑÿßŸÖ", t: "As-Salam", s: 131, m: "ÿ≥ŸÑÿßŸÖÿ™€å ŸàÿßŸÑÿß" },
            { a: "ÿßŸÑÿπÿ≤Ÿäÿ≤", t: "Al-Aziz", s: 94, m: "ÿ∫ÿßŸÑÿ®" },
            { a: "ÿßŸÑŸàÿØŸàÿØ", t: "Al-Wadud", s: 20, m: "ŸÖÿ≠ÿ®ÿ™ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑÿß" },
            { a: "ÿßŸÑŸÜŸàÿ±", t: "An-Nur", s: 256, m: "ÿ±Ÿàÿ¥ŸÜ ⁄©ÿ±ŸÜ€í ŸàÿßŸÑÿß" }
        ];

        const QUIZ_STEPS = [
            {
                q: "The gateway to your soul appears. What is it made of?",
                o: [
                    { t: "Eternal Flame", type: "Fire", i: "https://images.unsplash.com/photo-1520699049698-acd2fcc51056?auto=format&fit=crop&w=300&q=80" },
                    { t: "Deep Ocean", type: "Water", i: "https://images.unsplash.com/photo-1518837695005-2083093ee35b?auto=format&fit=crop&w=300&q=80" },
                    { t: "Ethereal Mist", type: "Air", i: "https://images.unsplash.com/photo-1505672675380-4d6d6fe5a8e5?auto=format&fit=crop&w=300&q=80" },
                    { t: "Ancient Stone", type: "Earth", i: "https://images.unsplash.com/photo-1542273917363-3b1817f69a2d?auto=format&fit=crop&w=300&q=80" }
                ]
            },
            {
                q: "Which celestial event resonates with your vibration?",
                o: [
                    { t: "Supernova", type: "Fire", i: "https://images.unsplash.com/photo-1462331940025-496dfbfc7564?auto=format&fit=crop&w=300&q=80" },
                    { t: "Meteor Shower", type: "Water", i: "https://images.unsplash.com/photo-1419242902214-272b3f66ee7a?auto=format&fit=crop&w=300&q=80" },
                    { t: "Aurora Borealis", type: "Air", i: "https://images.unsplash.com/photo-1531366936337-7c912a4589a7?auto=format&fit=crop&w=300&q=80" },
                    { t: "Solar Eclipse", type: "Earth", i: "https://images.unsplash.com/photo-1532978379173-5cf554a6965e?auto=format&fit=crop&w=300&q=80" }
                ]
            },
            {
                q: "You find a lost artifact in the sand. What is it?",
                o: [
                     { t: "Golden Crown", type: "Fire", i: "https://images.unsplash.com/photo-1605218427306-022ba8c26a42?auto=format&fit=crop&w=300&q=80" },
                     { t: "Silver Mirror", type: "Water", i: "https://images.unsplash.com/photo-1563205764-6e9352d9a934?auto=format&fit=crop&w=300&q=80" },
                     { t: "Antique Compass", type: "Air", i: "https://images.unsplash.com/photo-1623864467008-0125c1b6a378?auto=format&fit=crop&w=300&q=80" },
                     { t: "Bound Book", type: "Earth", i: "https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?auto=format&fit=crop&w=300&q=80" }
                ]
            },
            {
                q: "A storm approaches. What is your instinct?",
                o: [
                    { t: "Command it", type: "Fire", i: "https://images.unsplash.com/photo-1504639725590-34d0984388bd?auto=format&fit=crop&w=300&q=80" },
                    { t: "Flow with it", type: "Water", i: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?auto=format&fit=crop&w=300&q=80" },
                    { t: "Fly above it", type: "Air", i: "https://images.unsplash.com/photo-1487621167305-5d248087c724?auto=format&fit=crop&w=300&q=80" },
                    { t: "Stand firm", type: "Earth", i: "https://images.unsplash.com/photo-1500964757637-c85e8a162699?auto=format&fit=crop&w=300&q=80" }
                ]
            },
            {
                q: "Which color palette pulls your soul?",
                o: [
                    { t: "Crimson Red", type: "Fire", i: "https://images.unsplash.com/photo-1541414779316-956a5084c0d4?auto=format&fit=crop&w=300&q=80" },
                    { t: "Deep Teal", type: "Water", i: "https://images.unsplash.com/photo-1518063319789-7217e6706b04?auto=format&fit=crop&w=300&q=80" },
                    { t: "Azure Blue", type: "Air", i: "https://images.unsplash.com/photo-1536514498073-50e69d39c6cf?auto=format&fit=crop&w=300&q=80" },
                    { t: "Forest Green", type: "Earth", i: "https://images.unsplash.com/photo-1518173946687-a4c8892bbd9f?auto=format&fit=crop&w=300&q=80" }
                ]
            }
        ];

        // --- STATE ---
        let appState = {
            currentStep: 0,
            answers: [],
            userName: '',
            birthDay: null,
            birthMonth: null,
            chart: null
        };

        // --- HELPERS ---
        function showAlert(msg) {
            document.getElementById('alert-message').innerText = msg;
            document.getElementById('custom-alert').style.display = 'flex';
        }
        function closeAlert() { document.getElementById('custom-alert').style.display = 'none'; }

        function toggleMenu() { document.getElementById('side-menu').classList.toggle('open'); }

        function switchView(toId) {
            const views = ['home-view', 'intro-view', 'quiz-view', 'date-view', 'name-view', 'processing-view', 'result-view'];
            views.forEach(v => document.getElementById(v).classList.add('hidden'));
            document.getElementById(toId).classList.remove('hidden');
            window.scrollTo(0,0);
        }

        // --- NAVIGATION ---
        function openApp(id) { switchView(id); }
        function goHome() { switchView('home-view'); }

        function goToIntro() {
            const val = document.getElementById('reg-name').value;
            if(!val) return showAlert("Identity required.");
            appState.userName = val;
            appState.currentStep = 0;
            appState.answers = [];
            switchView('quiz-view');
            renderQuiz();
        }

        // --- QUIZ ENGINE ---
        function renderQuiz() {
            const step = QUIZ_STEPS[appState.currentStep];
            if(!step) return finishQuiz();

            document.getElementById('quiz-title').innerText = `Step ${appState.currentStep + 1}`;
            document.getElementById('quiz-question').innerText = step.q;
            document.getElementById('counter').innerText = `${Math.round((appState.currentStep / QUIZ_STEPS.length) * 100)}%`;
            document.getElementById('quiz-progress-bar').style.width = `${(appState.currentStep / QUIZ_STEPS.length) * 100}%`;

            const grid = document.getElementById('trait-grid');
            grid.innerHTML = '';
            step.o.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'relative group overflow-hidden rounded-2xl aspect-square shadow-lg hover:shadow-xl transition-all';
                btn.innerHTML = `
                    <img src="${opt.i}" class="absolute inset-0 w-full h-full object-cover group-hover:scale-110 transition-transform duration-500">
                    <div class="absolute inset-0 bg-black/40 flex items-end p-4">
                        <span class="text-white font-bold text-xs uppercase tracking-widest">${opt.t}</span>
                    </div>
                `;
                btn.onclick = () => {
                    appState.answers.push(opt.type);
                    appState.currentStep++;
                    renderQuiz();
                };
                grid.appendChild(btn);
            });
        }

        function finishQuiz() {
            switchView('date-view');
        }

        function goToNameView() {
            const d = parseInt(document.getElementById('birth-day').value);
            if(!d || d < 1 || d > 31) return showAlert("Invalid day coordinate.");
            appState.birthDay = d;
            appState.birthMonth = parseInt(document.getElementById('birth-month').value);
            switchView('name-view');
        }

        function liveUpdateAbjad(val) {
            const score = calcAbjad(val);
            document.getElementById('live-score').innerText = score;
            document.getElementById('live-calc-box').style.opacity = score > 0 ? 1 : 0;
        }

        function calcAbjad(str) {
            if(!str) return 0;
            const clean = str.replace(/[\u064B-\u065F\u0670\s]/g, '');
            return clean.split('').reduce((sum, char) => sum + (ABJAD_MAP[char] || 0), 0);
        }

        function startProcessing() {
            const urdu = document.getElementById('user-name-urdu').value;
            if(!urdu) return showAlert("Urdu Key missing.");
            switchView('processing-view');
            
            const msgs = ["Aligning Stars...", "Calculating Abjad...", "Finalizing Matrix..."];
            let i = 0;
            const timer = setInterval(() => {
                i++;
                if(i < msgs.length) document.getElementById('process-text').innerText = msgs[i];
            }, 1000);

            setTimeout(() => {
                clearInterval(timer);
                generateResults(urdu);
            }, 3000);
        }

        function getZodiac(d, m) {
            for(let z of ZODIAC_DATA) {
                if((m == z.start[0] && d >= z.start[1]) || (m == z.end[0] && d <= z.end[1])) return z;
            }
            return ZODIAC_DATA[ZODIAC_DATA.length - 1]; // Capricorn fallback
        }

        function generateResults(urdu) {
            const scores = { Fire:0, Air:0, Water:0, Earth:0 };
            appState.answers.forEach(a => scores[a]++);

            const winnerKey = Object.keys(scores).reduce((a, b) => scores[a] >= scores[b] ? a : b);
            const winner = ELEMENTS[winnerKey];
            const zodiac = getZodiac(appState.birthDay, appState.birthMonth);
            const abjad = calcAbjad(urdu);

            // Populate Results UI
            document.getElementById('final-user-name').innerText = appState.userName;
            document.getElementById('display-name').innerText = urdu;
            document.getElementById('winner-name').innerText = winnerKey;
            document.getElementById('winner-urdu').innerText = winner.urdu;
            document.getElementById('winner-icon').innerText = winner.icon;
            document.getElementById('qualities-text').innerText = winner.q;
            document.getElementById('challenges-text').innerText = winner.c;

            document.getElementById('zodiac-icon').innerText = zodiac.icon;
            document.getElementById('zodiac-name').innerText = zodiac.name;
            document.getElementById('zodiac-desc').innerText = zodiac.p;
            document.getElementById('zodiac-vocal').innerText = `Vibration: ${zodiac.s}`;

            document.getElementById('abjad-sum').innerText = abjad;
            renderAbjadMatches(abjad);
            renderChart(scores);

            switchView('result-view');
        }

        function renderAbjadMatches(sum) {
            const container = document.getElementById('abjad-matches');
            container.innerHTML = '';
            
            const matches = ASMA_UL_HUSNA.filter(n => n.s === sum);
            const displayList = matches.length > 0 ? matches : [ASMA_UL_HUSNA.reduce((p, c) => Math.abs(c.s - sum) < Math.abs(p.s - sum) ? c : p)];

            displayList.forEach(m => {
                const div = document.createElement('div');
                div.className = "p-4 bg-white rounded-2xl flex justify-between items-center shadow-sm border border-emerald-100";
                div.innerHTML = `
                    <div>
                        <h4 class="text-xl font-bold text-gray-800">${m.a}</h4>
                        <p class="text-[9px] font-bold text-emerald-600 uppercase tracking-widest">${m.t} (${m.s})</p>
                    </div>
                    <p class="text-xs text-gray-400 urdu">${m.m}</p>
                `;
                container.appendChild(div);
            });
        }

        function renderChart(scores) {
            const ctx = document.getElementById('elementChart').getContext('2d');
            if (appState.chart) appState.chart.destroy();

            appState.chart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Fire', 'Air', 'Water', 'Earth'],
                    datasets: [{
                        data: [scores.Fire, scores.Air, scores.Water, scores.Earth],
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: '#6366f1',
                        borderWidth: 2,
                        pointBackgroundColor: '#6366f1'
                    }]
                },
                options: {
                    scales: {
                        r: { 
                            beginAtZero: true, 
                            ticks: { display: false },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        }
                    },
                    plugins: { legend: { display: false } },
                    maintainAspectRatio: false
                }
            });
        }

        function resetApp() { location.reload(); }

        // Boot
        window.onload = () => {
            console.log("System Initialized.");
        };
    </script>
</body>
</html>